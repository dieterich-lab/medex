{% block content %}

<script type="module" src="{{ url_for('static', filename='js/measurement.js') }}"></script>


{# pretty multiselect inputs #}
<link rel="stylesheet" href="{{ url_for('static', filename='select2.css') }}">
<script src="{{ url_for('static', filename='select2.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='jquery-3.3.1.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='moment.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='daterangepicker.min.js') }}"></script>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='daterangepicker.css') }}" />

<link rel="stylesheet" href="{{ url_for('static', filename='ion.rangeSlider.min.css') }}" />
<script src="{{ url_for('static', filename='ion.rangeSlider.min.js') }}" ></script>
<input type="hidden" id="default_measurement" value="{{ measurement_tuple[0][0] }}" />

{% import 'macro_template.html' as m %}

<script type="text/javascript">
    var start = moment({{date[0]}});
    var end =  moment({{date[1]}});
</script>

<div class="card" style="display: {{ date_block }}">
    <div class="card-body">
        <label>Date range</label>
        <input id="Date" name="Date"
               style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
    </div>
</div>


<div class="card" style="display: {{ case_display }}">
    <div class="card-body">
        <label>Selected Case ID</label>
        <br>
        <a href="{{url_for('download', filename = 'case_ids.csv')}}" id="download"
           class="btn btn-outline-info">Download</a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <label>Filter</label>

        {{ m.entity_form_single_measurement(id_single_measurement= "filter_measurement",name =
                    measurement_tuple[0],value=entity,select=measurement_tuple[0][0],d=measurement_tuple[1],block=measurement_tuple[2]) }}

        <div class="form-check mt-4" style="display: none">
            <input class="form-check-input" type="checkbox" title="For large data, it may take longer to display the results
                    (maximum 1 min, if the query takes longer, the query will be killed)" value='true' id="limit_yes"
                   name="limit_yes" {% if limit_offset[2] %} checked {% endif %}>
            <label class="form-check-label" for="limit_yes">Limit selected number to: </label>
            <input style="width: 17%" id="limit" name="limit" title="For large data, it may take longer to display the results
                    (maximum 1 min, if the query takes longer, the query will be killed)" type="text"
                   class="js-input-from"
                   value="{{ limit_offset[0] }}"/>
            offset:
            <input style="width: 17%" id="offset" name="offset" type="text" class="js-input-from"
                   value="{{ limit_offset[1] }}">
        </div>

        <label for="selected_filter">Entity</label>
        <select id="selected_filter" style="width: 100%" class="js-example-basic-single"
                onchange="patient_filter.select_filter()"
                data-entity-types="String,Double,Date"
        >
        </select>

        <div id="categorical_filter_panel" style="display:none">
            <label for="categorical_filter_panel_categories">is</label>
            <select multiple id="categorical_filter_panel_categories" name="subcategory_filter" style="width: 100%"
                    class="form-control">
            </select><!-- filled by patient_filter.js -->
            <br/><br/>
            <button id="add_or_update_categorical_filter_btn" type="button" class="btn btn-outline-info"
                onclick="patient_filter.add_or_update_categorical_filter()"
            >
                Add or Update Filter
            </button>
        </div>

        <div style="display:none" id="numerical_filter_panel">
            <br/>
            <div class="range-slider">
                <input type="text" name="my-slider" id="numerical_filter_panel_range_slider" class="js-range-slider"/>
            </div>
            <br>
            <div class="extra-controls">
                from
                <input style="width: 30%" id="numerical_filter_settings_from_field" type="text" class="js-input-from"
                    onchange="patient_filter.set_numerical_filter_from()"
                />
                to
                <input style="width: 30%" id="numerical_filter_settings_to_field" type="text" class="js-input-to"
                    onchange="patient_filter.set_numerical_filter_to()"
                />
            </div>
            <br/>
            <button id="add_or_update_numerical_filter_btn" type="button" class="btn btn-outline-info"
                onclick="patient_filter.add_or_update_numerical_filter()"
            >
                Add or Update Filter
            </button>
        </div>
        <br>
    </div>
</div>

<div id='id_filter_results' class="card" style="display: block ">
    <div class="card-body">
        <p>
            <label>Filters<span id="filtered_patient_count"></span>:</label>
            <button id="clean" type="button" name='clean' value="clean" class="btn btn-outline-info" style="float: right"
                onclick="patient_filter.clear_all_filters()"
            >
                Clear All
            </button>
        </p>
        <div id="active_filters">
        </div>
    </div>
</div>


{% endblock %}
